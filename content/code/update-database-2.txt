DELETE {
  GRAPH <database> {
    ?origOwner ex:pet ?orig-pet .
    ?origPet a ex:pet ;
             ex:age ?age ;
             ex:name ?name .
  }
} INSERT {
  GRAPH <database> {
    ?newOwner ex:pet ?movedIri .
    ?movedIri a ex:pet ;
              ex:age ?age
              ex:name ?name
  }
} WHERE {
  # From received data:
  ?o ex:new-owner ?newOwner .
  BIND(URI( CONCAT(ex:owners, '/', ?id) )
      AS ?origOwner) .
  BIND(URI( CONCAT(?origOwner, '/', ?petId) )
      AS ?origPet) .
  BIND(URI( CONCAT(?newOwner, '/', ?petId) )
      AS ?movedIri) .
  # Go look in the current state of the database
  #     for whether the owner and pet exist.
  GRAPH <database> {
    ?origOwner ex:pet ?origPet .
    ?origPet a ex:pet ;
             ex:age ?age ;
             ex:name ?name .
    ?newOwner a ex:owner ;
  }
}
