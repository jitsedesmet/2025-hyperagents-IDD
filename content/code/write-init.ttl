@prefix idd: <https://jitsedesmet.be/interface-data-description#> .
@prefix ex: <https://example.org#> .
<post-owners> a idd:write-interface ;
              idd:interaction idd:http-post ;
              idd:http-resource <https://example.org/owners> ;
              idd:rdf-shape <owner-new-shape> ;
              idd:mapping """
PREFIX ex: <https://example.org/'>
CONSTRUCT {
    ?owner-bound ex:name ?name ;
                 ex:pets ?pet-bound .
    ?pet-bound ex:name ?petName ;
               ex:pet-type ?petType ;
               ex:age ?age .
} WHERE {
    ?resource ex:name ?name ;
              ex:pets ?pet .
    ?pet ex:name ?petName ;
         ex:pet-type ?petType ;
         ex:age ?age ;
    # UUID function creates a UUID scoped around the resource - within one execution the same UUID is returned for the same resource.
    #  On a different execution, a different UUID is returned. - similar to SHA256( now() + arg1 ) but less time focussed.
    BIND( UUID(?resource) AS ?owner-uuid ).
    BIND( CONCAT(ex:owners, '/', ?owner-uuid) AS ?owner-bound ) .
    BIND( UUID(?pet) AS ?pet-uuid ).
    BIND( CONCAT(?owner-bound, '/', ?pet-uuid) AS ?pet-bound ) .
}
"""^^idd:sparql-1-1 .